# rsnap v0 Spec (Prototype)

This repository contains a pure-Rust screenshot prototype targeting macOS first, with a
cross-platform architecture.

## Scope and current behavior

- Overlay starts from the global capture hotkey and runs a fullscreen, non-interactive
  capture layer per monitor.
- Live mode shows HUD widgets near the cursor that track pointer movement.
- Click-drag on the live overlay selects a rectangular region on the monitor under
  the cursor, then freezes that region.
- A single left click selects the window under the cursor on the current monitor;
  if no window is detected, it falls back to freezing that monitor fullscreen.
- Hovering over a window in live mode shows a glowing border that tracks the target
  window.
- `Space` copies the frozen PNG of the selected region/window/fullscreen to clipboard;
  `Esc` cancels capture.
- In Frozen mode, a loupe and toolbar are part of the floating HUD set and can still
  interact with pointer movement and redraw.

## v0 goals (must-have)

1. Menubar-only app (no Dock icon) on macOS.
2. Global hotkey starts capture session: `Alt+X` (macOS: Option+X).
3. When the capture session overlay is visible, underlying desktop content MUST NOT be
   interactive.
4. The overlay background should be transparent and non-dimming by default.
5. In live mode, the overlay MUST show a HUD near the cursor with:
   - global cursor coordinates `x,y`
   - pixel color `rgb(r,g,b)` under the cursor
6. The first prototype capture flow is:
   - Hotkey -> live transparent overlay
   - Left click + drag -> freeze a cropped region on the cursor monitor
   - Left click (without drag) -> hit-test window under the cursor on the same monitor and
     freeze that window bounds; fallback to fullscreen of the current monitor if no window is hit
   - `Space` -> copy the frozen cropped PNG (region/window/fullscreen) to the system clipboard, then exit
   - Esc -> cancel and exit without copying
7. Hover feedback and hit-test behavior:
   - While in live mode, hovering over a window highlights that window with an obvious glowing
     selection border.
   - This feedback follows cursor movement and updates as the cursor moves.
8. Capture scope constraints:
   - Region selection and window hit-testing are implemented only within the monitor containing
     the cursor.
   - Cross-monitor capture (including spanning-window and cross-monitor region selection) is deferred
     and tracked as future work.

## HUD, blur, tint and hue controls

Rendering is implemented through three floating widgets:

- Main HUD (live info + action hint)
- Loupe (Alt-held magnified sample)
- Frozen toolbar (only visible in frozen + captured states)

All three are styled using the same HUD styling pipeline.

- Architecture:
  - The capture layer is a transparent fullscreen overlay per monitor for input blocking.
  - The HUD widgets are separate always-on-top, borderless windows that follow the cursor
    and move with cursor tracking.
  - macOS native blur is enabled via native window configuration when Glass is enabled.
    Non-macOS uses the same styling fields and currently applies fake blur work paths.
- Blur control semantics:
  - `Glass HUD` toggles the whole style mode.
  - `Blur` controls blur amount (0..1); 0 disables blur.
  - Blur is independent from opacity in intent: with blur active, alpha is still
    constrained by blur style floor so the blur remains visually present even when overall
    opacity is low.
- Tint semantics:
  - `Tint` is tint intensity (0..1), currently implemented as `hud_milk_amount`.
  - `0` means no color shift, `1` means full hue shift.
- Hue semantics:
  - `Hue` sets target hue in `[0,1]` then rendered as 0-360° in UI.
  - Default is a system-blue sky hue (`0.585`), which corresponds to the default blue tone.

## Control defaults and input behavior

- Default settings:
  - HUD opacity: `0.75`
  - HUD blur: `0.25`
  - Tint amount: `0.0`
  - Hue: `0.585`
  - Alt mode: `Hold`
  - Loupe sample size: `Medium (21x21)`
- Slider semantics:
  - Opacity / Blur / Tint: slider and numeric entry are in `0..100` percentage points.
  - Input accepts integer percent values (`50`) and values without `%` in the same field.
  - Hue input is an integer degree value in `0..360`.
  - The HUD widget controls are disabled when `Glass HUD` is off.

## Cursor tracking and redraw behavior

- Cursor tracking is primarily event-driven from `WindowEvent::CursorMoved`.
- On macOS, overlay windows are configured to receive mouse-move events (native call path),
  and live cursor tracking updates HUD/loupe windows through event-based movement.
- For non-macOS, live cursor polling is used as a fallback to keep redraw/tick flowing.
- In live mode, tracking keeps the HUD aligned and requests redraw for both current monitor
  and previous monitor when crossing monitor boundaries.
- Frozen mode keeps toolbar/loupe/frozen-surface behavior stable and redraw-safe after capture.

## Live sampling performance notes

Live RGB/Loupe sampling should be **frame-stream based** (latest-frame sampling) rather than
“take a screenshot on cursor move”. This is required to avoid intermittent UI jank under
high-frequency cursor movement.

Research and cross-platform notes live in:

- `docs/research/live-sampling-streams.md`

## HUD/toolbar lifecycle

- All floating HUD windows are created at overlay start.
- In Frozen mode, loupe/toolbar visibility follows Alt + current mode state and
  `show_frozen_capture` state.

## Non-goals (v0)

- Annotation/editor UI, save-to-disk workflows, pinning, and advanced editing tools.
- Cross-monitor selection and cross-monitor window capture behavior.
